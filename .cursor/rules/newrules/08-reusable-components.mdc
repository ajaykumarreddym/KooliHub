---
description: Reusable Components & Widgets - DRY Component Patterns
globs: **/*.tsx
---

# Reusable Components & Widgets

## Overview
Guidelines for creating and using reusable components, widgets, and UI patterns to avoid code duplication and maintain consistency.

---

## 1. Component Architecture

### 1.1 Component Categories
```
components/
├── ui/                    # Base UI primitives (Radix-based)
│   ├── button.tsx
│   ├── input.tsx
│   └── ...
│
├── common/                # Shared business components
│   ├── LoadingSpinner.tsx
│   ├── ErrorBoundary.tsx
│   ├── EmptyState.tsx
│   └── ...
│
├── widgets/               # Reusable composed widgets
│   ├── PriceDisplay.tsx
│   ├── RatingStars.tsx
│   ├── StatusBadge.tsx
│   └── ...
│
└── {feature}/             # Feature-specific components
    ├── atoms/
    ├── molecules/
    └── organisms/
```

---

## 2. Common Reusable Widgets

### 2.1 Loading Spinner
```typescript
// client/components/common/LoadingSpinner.tsx

import { cn } from '@/lib/utils';
import { Loader2 } from 'lucide-react';

interface LoadingSpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  className?: string;
  text?: string;
}

const sizeClasses = {
  sm: 'h-4 w-4',
  md: 'h-6 w-6',
  lg: 'h-8 w-8',
};

export function LoadingSpinner({ 
  size = 'md', 
  className,
  text 
}: LoadingSpinnerProps) {
  return (
    <div className={cn('flex items-center justify-center gap-2', className)}>
      <Loader2 className={cn('animate-spin', sizeClasses[size])} />
      {text && <span className="text-sm text-muted-foreground">{text}</span>}
    </div>
  );
}

// Full page loading
export function PageLoader({ text = 'Loading...' }: { text?: string }) {
  return (
    <div className="flex items-center justify-center min-h-[400px]">
      <LoadingSpinner size="lg" text={text} />
    </div>
  );
}

// Overlay loading
export function LoadingOverlay({ show }: { show: boolean }) {
  if (!show) return null;
  
  return (
    <div className="absolute inset-0 bg-background/80 flex items-center justify-center z-50">
      <LoadingSpinner size="lg" />
    </div>
  );
}
```

### 2.2 Empty State
```typescript
// client/components/common/EmptyState.tsx

import { cn } from '@/lib/utils';
import { Button } from '@/components/ui/button';
import { LucideIcon, Package } from 'lucide-react';

interface EmptyStateProps {
  icon?: LucideIcon;
  title: string;
  description?: string;
  action?: {
    label: string;
    onClick: () => void;
  };
  className?: string;
}

export function EmptyState({
  icon: Icon = Package,
  title,
  description,
  action,
  className,
}: EmptyStateProps) {
  return (
    <div className={cn(
      'flex flex-col items-center justify-center py-12 px-4 text-center',
      className
    )}>
      <div className="rounded-full bg-muted p-4 mb-4">
        <Icon className="h-8 w-8 text-muted-foreground" />
      </div>
      <h3 className="text-lg font-semibold mb-2">{title}</h3>
      {description && (
        <p className="text-sm text-muted-foreground max-w-sm mb-4">
          {description}
        </p>
      )}
      {action && (
        <Button onClick={action.onClick}>
          {action.label}
        </Button>
      )}
    </div>
  );
}

// Preset empty states
export function NoProductsEmpty({ onAdd }: { onAdd?: () => void }) {
  return (
    <EmptyState
      title="No products found"
      description="Start by adding your first product"
      action={onAdd ? { label: 'Add Product', onClick: onAdd } : undefined}
    />
  );
}

export function NoOrdersEmpty() {
  return (
    <EmptyState
      title="No orders yet"
      description="Your order history will appear here"
    />
  );
}

export function SearchEmpty({ query }: { query: string }) {
  return (
    <EmptyState
      title="No results found"
      description={`We couldn't find anything matching "${query}"`}
    />
  );
}
```

### 2.3 Error State
```typescript
// client/components/common/ErrorState.tsx

import { cn } from '@/lib/utils';
import { Button } from '@/components/ui/button';
import { AlertCircle, RefreshCw } from 'lucide-react';

interface ErrorStateProps {
  title?: string;
  message?: string;
  onRetry?: () => void;
  className?: string;
}

export function ErrorState({
  title = 'Something went wrong',
  message = 'Please try again later',
  onRetry,
  className,
}: ErrorStateProps) {
  return (
    <div className={cn(
      'flex flex-col items-center justify-center py-12 px-4 text-center',
      className
    )}>
      <div className="rounded-full bg-destructive/10 p-4 mb-4">
        <AlertCircle className="h-8 w-8 text-destructive" />
      </div>
      <h3 className="text-lg font-semibold mb-2">{title}</h3>
      <p className="text-sm text-muted-foreground max-w-sm mb-4">
        {message}
      </p>
      {onRetry && (
        <Button variant="outline" onClick={onRetry}>
          <RefreshCw className="h-4 w-4 mr-2" />
          Try Again
        </Button>
      )}
    </div>
  );
}
```

### 2.4 Price Display
```typescript
// client/components/widgets/PriceDisplay.tsx

import { cn } from '@/lib/utils';
import { formatCurrency } from '@/lib/format-utils';

interface PriceDisplayProps {
  price: number;
  originalPrice?: number;
  size?: 'sm' | 'md' | 'lg';
  showDiscount?: boolean;
  className?: string;
}

const sizeClasses = {
  sm: { price: 'text-sm font-semibold', original: 'text-xs' },
  md: { price: 'text-lg font-bold', original: 'text-sm' },
  lg: { price: 'text-2xl font-bold', original: 'text-base' },
};

export function PriceDisplay({
  price,
  originalPrice,
  size = 'md',
  showDiscount = true,
  className,
}: PriceDisplayProps) {
  const hasDiscount = originalPrice && originalPrice > price;
  const discountPercent = hasDiscount 
    ? Math.round(((originalPrice - price) / originalPrice) * 100)
    : 0;

  return (
    <div className={cn('flex items-center gap-2 flex-wrap', className)}>
      <span className={cn(sizeClasses[size].price, 'tabular-nums')}>
        {formatCurrency(price)}
      </span>
      
      {hasDiscount && (
        <>
          <span className={cn(
            sizeClasses[size].original,
            'text-muted-foreground line-through tabular-nums'
          )}>
            {formatCurrency(originalPrice)}
          </span>
          
          {showDiscount && (
            <span className="text-xs font-medium text-green-600 bg-green-50 px-1.5 py-0.5 rounded">
              {discountPercent}% off
            </span>
          )}
        </>
      )}
    </div>
  );
}
```

### 2.5 Rating Stars
```typescript
// client/components/widgets/RatingStars.tsx

import { cn } from '@/lib/utils';
import { Star, StarHalf } from 'lucide-react';

interface RatingStarsProps {
  rating: number;
  maxRating?: number;
  size?: 'sm' | 'md' | 'lg';
  showValue?: boolean;
  reviewCount?: number;
  className?: string;
}

const sizeClasses = {
  sm: 'h-3 w-3',
  md: 'h-4 w-4',
  lg: 'h-5 w-5',
};

export function RatingStars({
  rating,
  maxRating = 5,
  size = 'md',
  showValue = true,
  reviewCount,
  className,
}: RatingStarsProps) {
  const fullStars = Math.floor(rating);
  const hasHalfStar = rating % 1 >= 0.5;
  const emptyStars = maxRating - fullStars - (hasHalfStar ? 1 : 0);

  return (
    <div className={cn('flex items-center gap-1', className)}>
      <div className="flex">
        {/* Full stars */}
        {Array.from({ length: fullStars }).map((_, i) => (
          <Star 
            key={`full-${i}`} 
            className={cn(sizeClasses[size], 'fill-yellow-400 text-yellow-400')} 
          />
        ))}
        
        {/* Half star */}
        {hasHalfStar && (
          <div className="relative">
            <Star className={cn(sizeClasses[size], 'text-gray-300')} />
            <div className="absolute inset-0 overflow-hidden w-1/2">
              <Star className={cn(sizeClasses[size], 'fill-yellow-400 text-yellow-400')} />
            </div>
          </div>
        )}
        
        {/* Empty stars */}
        {Array.from({ length: emptyStars }).map((_, i) => (
          <Star 
            key={`empty-${i}`} 
            className={cn(sizeClasses[size], 'text-gray-300')} 
          />
        ))}
      </div>
      
      {showValue && (
        <span className="text-sm font-medium tabular-nums">
          {rating.toFixed(1)}
        </span>
      )}
      
      {reviewCount !== undefined && (
        <span className="text-sm text-muted-foreground">
          ({reviewCount.toLocaleString()})
        </span>
      )}
    </div>
  );
}
```

### 2.6 Status Badge
```typescript
// client/components/widgets/StatusBadge.tsx

import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { 
  getOrderStatusColor, 
  getPaymentStatusColor,
  getVendorStatusColor,
  getTripStatusColor,
} from '@/lib/status-colors';

type StatusType = 'order' | 'payment' | 'vendor' | 'trip' | 'generic';

interface StatusBadgeProps {
  status: string;
  type?: StatusType;
  showDot?: boolean;
  className?: string;
}

const getStatusColor = (type: StatusType, status: string) => {
  switch (type) {
    case 'order': return getOrderStatusColor(status);
    case 'payment': return getPaymentStatusColor(status);
    case 'vendor': return getVendorStatusColor(status);
    case 'trip': return getTripStatusColor(status);
    default: return { bg: 'bg-gray-100', text: 'text-gray-800' };
  }
};

const formatStatus = (status: string) => {
  return status
    .replace(/_/g, ' ')
    .replace(/\b\w/g, c => c.toUpperCase());
};

export function StatusBadge({
  status,
  type = 'generic',
  showDot = true,
  className,
}: StatusBadgeProps) {
  const colors = getStatusColor(type, status);

  return (
    <Badge 
      variant="secondary" 
      className={cn(colors.bg, colors.text, 'font-medium', className)}
    >
      {showDot && (
        <span className={cn('w-2 h-2 rounded-full mr-2', colors.dot || colors.bg)} />
      )}
      {formatStatus(status)}
    </Badge>
  );
}

// Specialized badges
export function OrderStatusBadge({ status }: { status: string }) {
  return <StatusBadge status={status} type="order" />;
}

export function PaymentStatusBadge({ status }: { status: string }) {
  return <StatusBadge status={status} type="payment" />;
}

export function VendorStatusBadge({ status }: { status: string }) {
  return <StatusBadge status={status} type="vendor" />;
}

export function TripStatusBadge({ status }: { status: string }) {
  return <StatusBadge status={status} type="trip" />;
}
```

### 2.7 Avatar with Fallback
```typescript
// client/components/widgets/UserAvatar.tsx

import { cn } from '@/lib/utils';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { User } from 'lucide-react';

interface UserAvatarProps {
  src?: string | null;
  name?: string | null;
  size?: 'sm' | 'md' | 'lg' | 'xl';
  className?: string;
}

const sizeClasses = {
  sm: 'h-8 w-8',
  md: 'h-10 w-10',
  lg: 'h-12 w-12',
  xl: 'h-16 w-16',
};

const iconSizes = {
  sm: 'h-4 w-4',
  md: 'h-5 w-5',
  lg: 'h-6 w-6',
  xl: 'h-8 w-8',
};

const getInitials = (name: string | null | undefined): string => {
  if (!name) return '';
  return name
    .split(' ')
    .map(part => part[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);
};

export function UserAvatar({ src, name, size = 'md', className }: UserAvatarProps) {
  const initials = getInitials(name);

  return (
    <Avatar className={cn(sizeClasses[size], className)}>
      <AvatarImage src={src || undefined} alt={name || 'User'} />
      <AvatarFallback className="bg-primary/10 text-primary">
        {initials || <User className={iconSizes[size]} />}
      </AvatarFallback>
    </Avatar>
  );
}
```

### 2.8 Confirm Dialog
```typescript
// client/components/widgets/ConfirmDialog.tsx

import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { ACTIONS, MESSAGES } from '@/lib/strings';

interface ConfirmDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title?: string;
  description?: string;
  confirmLabel?: string;
  cancelLabel?: string;
  variant?: 'default' | 'destructive';
  onConfirm: () => void;
}

export function ConfirmDialog({
  open,
  onOpenChange,
  title = 'Are you sure?',
  description = MESSAGES.confirm.delete,
  confirmLabel = ACTIONS.confirm,
  cancelLabel = ACTIONS.cancel,
  variant = 'default',
  onConfirm,
}: ConfirmDialogProps) {
  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>{title}</AlertDialogTitle>
          <AlertDialogDescription>{description}</AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>{cancelLabel}</AlertDialogCancel>
          <AlertDialogAction
            onClick={onConfirm}
            className={variant === 'destructive' ? 'bg-destructive hover:bg-destructive/90' : ''}
          >
            {confirmLabel}
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}

// Hook for easier usage
export function useConfirmDialog() {
  const [isOpen, setIsOpen] = useState(false);
  const [pendingAction, setPendingAction] = useState<(() => void) | null>(null);

  const confirm = (action: () => void) => {
    setPendingAction(() => action);
    setIsOpen(true);
  };

  const handleConfirm = () => {
    pendingAction?.();
    setIsOpen(false);
    setPendingAction(null);
  };

  return {
    isOpen,
    setIsOpen,
    confirm,
    handleConfirm,
  };
}
```

---

## 3. Compound Components Pattern

### 3.1 Data Table Widget
```typescript
// client/components/widgets/DataTable.tsx

import { cn } from '@/lib/utils';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { LoadingSpinner } from '@/components/common/LoadingSpinner';
import { EmptyState } from '@/components/common/EmptyState';

interface Column<T> {
  key: string;
  header: string;
  cell: (item: T) => React.ReactNode;
  className?: string;
}

interface DataTableProps<T> {
  columns: Column<T>[];
  data: T[];
  loading?: boolean;
  emptyMessage?: string;
  onRowClick?: (item: T) => void;
  className?: string;
}

export function DataTable<T extends { id: string }>({
  columns,
  data,
  loading,
  emptyMessage = 'No data found',
  onRowClick,
  className,
}: DataTableProps<T>) {
  if (loading) {
    return <LoadingSpinner className="py-12" />;
  }

  if (data.length === 0) {
    return <EmptyState title={emptyMessage} />;
  }

  return (
    <div className={cn('rounded-md border', className)}>
      <Table>
        <TableHeader>
          <TableRow>
            {columns.map((col) => (
              <TableHead key={col.key} className={col.className}>
                {col.header}
              </TableHead>
            ))}
          </TableRow>
        </TableHeader>
        <TableBody>
          {data.map((item) => (
            <TableRow
              key={item.id}
              onClick={() => onRowClick?.(item)}
              className={onRowClick ? 'cursor-pointer hover:bg-muted/50' : ''}
            >
              {columns.map((col) => (
                <TableCell key={col.key} className={col.className}>
                  {col.cell(item)}
                </TableCell>
              ))}
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  );
}
```

---

## 4. Composition Patterns

### 4.1 Wrapper Components
```typescript
// Page wrapper with common layout
export function PageWrapper({ 
  title,
  description,
  actions,
  children 
}: {
  title: string;
  description?: string;
  actions?: React.ReactNode;
  children: React.ReactNode;
}) {
  return (
    <div className="container mx-auto px-4 py-8">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
        <div>
          <h1 className="text-3xl font-bold">{title}</h1>
          {description && (
            <p className="text-muted-foreground mt-1">{description}</p>
          )}
        </div>
        {actions && <div className="flex gap-2">{actions}</div>}
      </div>
      {children}
    </div>
  );
}
```

### 4.2 Conditional Wrapper
```typescript
// Conditional wrapper utility
export function ConditionalWrapper({
  condition,
  wrapper,
  children,
}: {
  condition: boolean;
  wrapper: (children: React.ReactNode) => React.ReactNode;
  children: React.ReactNode;
}) {
  return condition ? wrapper(children) : children;
}

// Usage
<ConditionalWrapper
  condition={hasLink}
  wrapper={(children) => <Link to={href}>{children}</Link>}
>
  <Card>...</Card>
</ConditionalWrapper>
```

---

## 5. Rules Summary

### DO:
- ✅ Create reusable components for repeated UI patterns
- ✅ Use composition over inheritance
- ✅ Support className prop for style overrides
- ✅ Include TypeScript types for all props
- ✅ Provide sensible defaults
- ✅ Create specialized variants for common use cases

### DON'T:
- ❌ Duplicate UI code across components
- ❌ Hardcode strings in components (use strings.ts)
- ❌ Create overly complex prop APIs
- ❌ Mix business logic with UI components
- ❌ Ignore loading/error/empty states

---

**Related Files**:
- `client/components/common/` - Common reusable components
- `client/components/widgets/` - Composed widget components
- `client/components/ui/` - Base UI primitives
